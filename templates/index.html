<!-- Keep all previous HTML and CSS the same, just update the script section -->

<script>
    // Remove the old keypress event listener and add this new one
    document.getElementById('message-input').addEventListener('keydown', function(e) {
        // Check if it's the Enter key and not Shift+Enter
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault(); // This should prevent the new line
            const message = this.value.trim();
            if (message) {
                sendMessage();
            }
        }
    });

    function sendMessage() {
        const input = document.getElementById('message-input');
        const message = input.value.trim();
        
        if (!message) return;

        displayMessage(message, 'user');
        
        fetch('/chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ message: message })
        }).then(response => {
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let botMessage = '';
            let botDiv = document.createElement('div');
            botDiv.className = 'message-container bot-message';
            document.getElementById('chat-box').appendChild(botDiv);
            
            function readStream() {
                return reader.read().then(({done, value}) => {
                    if (done) return;
                    
                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');
                    
                    lines.forEach(line => {
                        if (line.startsWith('data: ')) {
                            const content = line.slice(6);
                            if (content === '[DONE]') return;
                            botMessage += content;
                            botDiv.textContent = botMessage;
                            botDiv.scrollIntoView({ behavior: 'smooth' });
                        }
                    });
                    
                    return readStream();
                });
            }
            
            return readStream();
        }).catch(error => {
            console.error('Error:', error);
            displayMessage('Error: Failed to get response', 'error');
        });

        input.value = '';
        input.style.height = 'auto';
    }

    function displayMessage(message, type) {
        const chatBox = document.getElementById('chat-box');
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message-container ' + (type === 'user' ? 'user-message' : 'bot-message');
        messageDiv.textContent = message;
        chatBox.appendChild(messageDiv);
        messageDiv.scrollIntoView({ behavior: 'smooth' });
    }
</script>
